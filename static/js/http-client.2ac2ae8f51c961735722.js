webpackJsonp([16],{HbeG:function(s,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=a("YbtR"),n=a("jUGl"),i=a("VU/8"),l=i(e.a,n.a,null,null,null);t.default=l.exports},YbtR:function(s,t,a){"use strict";var e=a("c/Tr"),n=a.n(e);t.a={name:"http-client",mounted:function(){var s=this,t=n()(document.getElementsByClassName("title")),a=t.filter(function(t){return t.innerHTML===s.$route.query.title})[0];a?a.scrollIntoView():scroll(0,0)},data:function(){return{}},methods:{}}},jUGl:function(s,t,a){"use strict";var e=function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",[a("back-nav",{attrs:{title:"Making API Requests"}}),s._m(0)],1)},n=[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",{staticClass:"section"},[a("div",{staticClass:"container"},[a("div",{staticClass:"content"},[s._v("In this section of the tutorial we'll look at Axios and how to organize ajax calls\nto our backend server API...")]),a("div",{staticClass:"title is-4"},[s._v("Install Axios HTTP Client")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs bash"},[s._v("npm install axios --save-dev\n\n")])]),a("div",{staticClass:"title is-4"},[s._v("Create Vue Plugin")]),a("div",{staticClass:"content"},[s._v("First let's create a "),a("a",{attrs:{href:"https://vuejs.org/v2/guide/plugins.html"}},[s._v("Vue plugin")]),s._v("so we can make "),a("code",[s._v("Vue.http")]),s._v("or from within components as  "),a("code",[s._v("this.$http ")]),s._v("calls using Axios:")]),a("strong",{staticClass:"app-italic"},[s._v("http/index.js")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs javascript"},[a("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios "),a("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v(";\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n\n  install (Vue, options) {\n    Vue.prototype.$http = Vue.http = axios.create()\n  }\n}\n")])]),a("div",{staticClass:"title is-4"},[s._v("Organizing Requests to Backend Server API")]),a("div",{staticClass:"content"},[s._v("It's better to abstract API calls to your backend server so that components can add\nthe bits of code that better pertain to its business domain. And it's nice to keep\nall these API calls together so a clearly visible list of all the API endpoints is established \n(similiar to how the routes files collects the external API of your app, this would collects\nthe API to your backend). Let's list all the API endpoint calls in a file.\nFor example, a component may want to make an API call  "),a("code",[s._v("getFriends")]),s._v(":")]),a("strong",{staticClass:"app-italic"},[s._v("http/api.js")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs javascript"},[a("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" auth "),a("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),a("span",{staticClass:"hljs-string"},[s._v("'@/auth/helpers'")]),s._v(";\n\n"),a("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),a("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n\n  "),a("span",{staticClass:"hljs-comment"},[s._v("// List out all your API requests here.")]),s._v("\n\n  getFriends (callback) { auth.get("),a("span",{staticClass:"hljs-string"},[s._v("'/response'")]),s._v(", {}, callback) }\n}\n")])]),a("div",{staticClass:"title is-4"},[s._v("Proxy Api Calls in the Dev Server")]),a("div",{staticClass:"title is-6"},[s._v("Setup Proxy on Dev Server")]),a("div",{staticClass:"content"},[s._v("When using Webpack for Hot Reloading, we'll need to tell the webpack dev server\nthat `/api` calls need to be reverse proxied to another server (ie. running on\nnode express, nginx, or some embedded server in your IDE). For production you\nwould just use nginx to do the proxying. The big advantage is we don't have to\nworry about CORS and also we don't expose the true API endpoints to the client\n(better protection from DDoS attacks).")]),a("div",{staticClass:"content"},[s._v("Notice in "),a("code",[s._v("build/dev-server.js")]),s._v("this line:")]),a("strong",{staticClass:"app-italic"},[s._v("build/dev-server.js")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs javascript"},[a("span",{staticClass:"hljs-comment"},[s._v("// proxy api requests")]),s._v("\n"),a("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".keys(proxyTable).forEach("),a("span",{staticClass:"hljs-function"},[a("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),a("span",{staticClass:"hljs-params"},[s._v("context")]),s._v(") ")]),s._v("{\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" options = proxyTable[context]\n  "),a("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),a("span",{staticClass:"hljs-keyword"},[s._v("typeof")]),s._v(" options === "),a("span",{staticClass:"hljs-string"},[s._v("'string'")]),s._v(") {\n    options = { target: options }\n  }\n  app.use(proxyMiddleware(context, options))\n})\n")])]),a("div",{staticClass:"content"},[s._v("In this setup we are using: https://github.com/chimurai/http-proxy-middleware (you can\nsee examples there). So let's add options to our config to make this work:")]),a("div",{staticClass:"content"},[s._v("In "),a("code",[s._v("config/index.js")]),s._v(", update the "),a("strong",[s._v("proxyTable ")]),s._v("object to look like this:")]),a("strong",{staticClass:"app-italic"},[s._v("config/index.js")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs javascript"},[s._v("dev:  {\n\n    "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n    \n    proxyTable: {\n      "),a("span",{staticClass:"hljs-string"},[s._v("'/auth'")]),s._v(": {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// @"),a("span",{staticClass:"hljs-doctag"},[s._v("TODO:")]),s._v(" You need to replace this with your own backend API.")]),s._v("\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// Demo OAuth2 server https://github.com/bshaffer/oauth2-demo-php.")]),s._v("\n        target: "),a("span",{staticClass:"hljs-string"},[s._v("'http://brentertainment.com/oauth2/lockdin/token'")]),s._v(",\n        changeOrigin: "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(",\n        ws: "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(",\n        pathRewrite: {\n          "),a("span",{staticClass:"hljs-string"},[s._v("'^/auth'")]),s._v(": "),a("span",{staticClass:"hljs-string"},[s._v("''")]),s._v("\n        },\n        router: {\n        }\n      },\n      "),a("span",{staticClass:"hljs-string"},[s._v("'/api'")]),s._v(": {\n        target: "),a("span",{staticClass:"hljs-string"},[s._v("'http://brentertainment.com/oauth2'")]),s._v(",  "),a("span",{staticClass:"hljs-comment"},[s._v("// <-- Api server.")]),s._v("\n        changeOrigin: "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(",                           "),a("span",{staticClass:"hljs-comment"},[s._v("// <-- For virtual hosted sites.")]),s._v("\n        ws: "),a("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(",                                     "),a("span",{staticClass:"hljs-comment"},[s._v("// <-- Proxy websockets.")]),s._v("\n        pathRewrite: {\n        "),a("span",{staticClass:"hljs-comment"},[s._v("// Rewrite path localhost:8080/api to http://brentertainment.com/oauth2/lockdin.")]),s._v("\n          "),a("span",{staticClass:"hljs-string"},[s._v("'^/api'")]),s._v(": "),a("span",{staticClass:"hljs-string"},[s._v("'/lockdin'")]),s._v("\n        },\n        router: {\n          "),a("span",{staticClass:"hljs-comment"},[s._v("// when request.headers.host == 'dev.localhost:3000',")]),s._v("\n          "),a("span",{staticClass:"hljs-comment"},[s._v("// override target 'http://www.example.org' to 'http://localhost:8000'")]),s._v("\n          "),a("span",{staticClass:"hljs-comment"},[s._v("// 'dev.localhost:3000': 'http://localhost:8000'")]),s._v("\n        }\n      }\n    },\n    \n    "),a("span",{staticClass:"hljs-comment"},[s._v("// ...")]),s._v("\n}\n")])]),a("div",{staticClass:"title is-4"},[s._v("Proxy Api Calls in Nginx Production Server")]),a("div",{staticClass:"content"},[s._v("If you are using nginx on your production server, you can reverse proxy using the following configuration:")]),a("pre",{staticClass:"block"},[a("code",{staticClass:"hljs javascript"},[a("span",{staticClass:"hljs-comment"},[s._v("// work in progress...")])])])])])}],i={render:e,staticRenderFns:n};t.a=i}});
//# sourceMappingURL=http-client.2ac2ae8f51c961735722.js.map