webpackJsonp([21],{"8l3q":function(s,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=t("gUUB"),n=t("fVzj"),r=t("VU/8"),l=r(e.a,n.a,null,null,null);a.default=l.exports},fVzj:function(s,a,t){"use strict";var e=function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",[t("back-nav",{attrs:{title:"Authentication"}}),s._m(0)],1)},n=[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("section",{staticClass:"section"},[t("div",{staticClass:"container"},[t("div",{staticClass:"content"},[s._v("In this section of the tutorial we'll look at Authentication and OAuth2...")]),t("div",{staticClass:"title is-4"},[s._v("Auth Plugin")]),t("strong",{staticClass:"app-italic"},[s._v("src/auth/index.js")]),t("pre",{staticClass:"block"},[t("code",{staticClass:"hljs javascript"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Vue "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'vue'")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" store "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'@/vuex'")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" axios "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'axios'")]),s._v(";\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" API_BASE_URL = "),t("span",{staticClass:"hljs-string"},[s._v("'/api'")]),s._v("\n"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" REFRESH_TOKEN_URL = "),t("span",{staticClass:"hljs-string"},[s._v("'/auth'")]),s._v("\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("// const CLIENT_SECRET = 'demopass' // Base64(client_id:client_secret) \"demoapp:demopass\"")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n\n  install (Vue, options) {\n    Vue.prototype.$auth = Vue.auth = axios.create()\n\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".setDefaults()\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".addInterceptors()\n  },\n\n  setDefaults () {\n    Vue.auth.defaults.baseURL = API_BASE_URL\n  },\n\n  addInterceptors () {\n    "),t("span",{staticClass:"hljs-comment"},[s._v("// Watch for accessToken changes and update our common Auth header.")]),s._v("\n    store.watch((state) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" state.auth.accessToken\n    }, (accessToken) => {\n      Vue.auth.defaults.headers.common["),t("span",{staticClass:"hljs-string"},[s._v("'Authorization'")]),s._v("] = "),t("span",{staticClass:"hljs-string"},[s._v("'Bearer '")]),s._v(" + accessToken\n      Vue.auth.defaults.transformRequest = [(data, headers) => {\n        data.access_token = accessToken\n        "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" data\n      }]\n      "),t("span",{staticClass:"hljs-built_in"},[s._v("console")]),s._v(".log("),t("span",{staticClass:"hljs-string"},[s._v("'token set'")]),s._v(")\n    }, {\n      deep: "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v("\n    })\n\n    "),t("span",{staticClass:"hljs-comment"},[s._v("// Intercept the response and refresh (one retry) if invalid token.")]),s._v("\n    Vue.auth.interceptors.response.use("),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("response")]),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".isInvalidToken(response)) {\n        "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".refreshToken(response.request)\n      }\n    }, "),t("span",{staticClass:"hljs-function"},[t("span",{staticClass:"hljs-keyword"},[s._v("function")]),s._v(" ("),t("span",{staticClass:"hljs-params"},[s._v("error")]),s._v(") ")]),s._v("{\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-built_in"},[s._v("Promise")]),s._v(".reject(error)\n    })\n  },\n\n  isInvalidToken (response) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" status = response.status\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" error = response.data.error\n\n    "),t("span",{staticClass:"hljs-comment"},[s._v("// Customize this to your Oauth server.")]),s._v("\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" (status === "),t("span",{staticClass:"hljs-number"},[s._v("401")]),s._v(" && (error === "),t("span",{staticClass:"hljs-string"},[s._v("'invalid_token'")]),s._v(" || error === "),t("span",{staticClass:"hljs-string"},[s._v("'expired_token'")]),s._v("))\n  },\n\n  refreshToken (request) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" axios({\n      method: "),t("span",{staticClass:"hljs-string"},[s._v("'post'")]),s._v(",\n      url: REFRESH_TOKEN_URL,\n      "),t("span",{staticClass:"hljs-comment"},[s._v("// headers: {'Authorization': 'Basic ' + CLIENT_SECRET},")]),s._v("\n      data: {\n        grant_type: "),t("span",{staticClass:"hljs-string"},[s._v("'refresh_token'")]),s._v(",\n        refresh_token: store.state.auth.refreshToken\n      }\n    })\n    .then((response) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".storeToken(response)\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".retry(request)\n    })\n    .catch((errorResponse) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".isInvalidToken(errorResponse)) { "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".logout() }\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" errorResponse\n    })\n  },\n\n  storeToken (response) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" auth = store.state.auth\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" user = store.state.user\n\n    auth.isLoggedIn = "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v("\n    auth.accessToken = response.data.access_token\n    auth.refreshToken = response.data.refresh_token\n    "),t("span",{staticClass:"hljs-comment"},[s._v("// "),t("span",{staticClass:"hljs-doctag"},[s._v("TODO:")]),s._v(" get user's name from response from Oauth server.")]),s._v("\n    user.name = "),t("span",{staticClass:"hljs-string"},[s._v("'John Smith'")]),s._v("\n\n    store.commit("),t("span",{staticClass:"hljs-string"},[s._v("'UPDATE_AUTH'")]),s._v(", auth)\n    store.commit("),t("span",{staticClass:"hljs-string"},[s._v("'UPDATE_USER'")]),s._v(", user)\n  },\n\n  retry (request) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" Vue.auth(request)\n      .then((response) => { "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" response })\n      .catch((response) => { "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" response })\n  }\n}\n\n")])]),t("div",{staticClass:"title is-4"},[s._v("Auth Helpers")]),t("div",{staticClass:"content"},[s._v(" We'll need some helpers so we can do things like login, logout, \nor make requests to private endpoints easier.")]),t("strong",{staticClass:"app-italic"},[s._v("src/auth/index.js")]),t("pre",{staticClass:"block"},[t("code",{staticClass:"hljs javascript"},[t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" Vue "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'vue'")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" router "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'@/router'")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" store "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'@/vuex'")]),s._v(";\n"),t("span",{staticClass:"hljs-keyword"},[s._v("import")]),s._v(" auth "),t("span",{staticClass:"hljs-keyword"},[s._v("from")]),s._v(" "),t("span",{staticClass:"hljs-string"},[s._v("'./'")]),s._v(";\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("const")]),s._v(" LOGIN_URL = "),t("span",{staticClass:"hljs-string"},[s._v("'/auth'")]),s._v("\n\n"),t("span",{staticClass:"hljs-comment"},[s._v("// const CLIENT_SECRET = 'ZGVtb2FwcDpkZW1vcGFzcw==' // Base64(client_id:client_secret) \"demoapp:demopass\"")]),s._v("\n\n"),t("span",{staticClass:"hljs-keyword"},[s._v("export")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("default")]),s._v(" {\n  URLSearchParams (obj) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" params = "),t("span",{staticClass:"hljs-keyword"},[s._v("new")]),s._v(" URLSearchParams()\n\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("for")]),s._v(" ("),t("span",{staticClass:"hljs-keyword"},[s._v("var")]),s._v(" [key, value] "),t("span",{staticClass:"hljs-keyword"},[s._v("of")]),s._v(" "),t("span",{staticClass:"hljs-built_in"},[s._v("Object")]),s._v(".entries(obj)) params.append(key, value)\n\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" params\n  },\n\n  login (creds, redirect, callback) {\n    "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v(" Vue.http({\n      method: "),t("span",{staticClass:"hljs-string"},[s._v("'post'")]),s._v(",\n      url: LOGIN_URL,\n      "),t("span",{staticClass:"hljs-comment"},[s._v("// headers: {")]),s._v("\n      "),t("span",{staticClass:"hljs-comment"},[s._v("//  'Authorization': 'Basic ' + CLIENT_SECRET,")]),s._v("\n      "),t("span",{staticClass:"hljs-comment"},[s._v("//  'Content-Type': 'application/x-www-form-urlencoded'")]),s._v("\n      "),t("span",{staticClass:"hljs-comment"},[s._v("// },")]),s._v("\n      data: "),t("span",{staticClass:"hljs-keyword"},[s._v("this")]),s._v(".URLSearchParams({\n        grant_type: "),t("span",{staticClass:"hljs-string"},[s._v("'password'")]),s._v(",\n        client_id: "),t("span",{staticClass:"hljs-string"},[s._v("'demoapp'")]),s._v(",\n        client_secret: "),t("span",{staticClass:"hljs-string"},[s._v("'demopass'")]),s._v(",\n        username: creds.username,\n        password: creds.password\n      })\n    })\n    .then((response) => {\n      auth.storeToken(response)\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (redirect) router.push({ name: redirect })\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (callback) callback({ isSuccess: "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(", data: {}, errorMessage: "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v(" })\n    })\n    .catch((error) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!callback) "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v("\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" errorMessage = "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v("\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (error.response) errorMessage = error.response.status\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (error.request) errorMessage = "),t("span",{staticClass:"hljs-string"},[s._v("'no response from server'")]),s._v("\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" errorMessage = error.message\n\n      callback({\n        isSuccess: "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(",\n        data: {},\n        errorMessage: errorMessage\n      })\n    })\n  },\n\n  logout () {\n    store.commit("),t("span",{staticClass:"hljs-string"},[s._v("'CLEAR_ALL_DATA'")]),s._v(")\n    router.push({ name: "),t("span",{staticClass:"hljs-string"},[s._v("'login'")]),s._v(" })\n  },\n\n  fakeLogin (creds, redirect, callback) {\n    setTimeout(() => {\n      auth.storeToken({data: { accessToken: "),t("span",{staticClass:"hljs-string"},[s._v("'123456789'")]),s._v(", refreshToken: "),t("span",{staticClass:"hljs-string"},[s._v("'77777777'")]),s._v(" }})\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (redirect) router.push({ name: redirect })\n    }, "),t("span",{staticClass:"hljs-number"},[s._v("500")]),s._v(")\n  },\n\n  get (url, params, callback) {\n    Vue.auth.get({url, params})\n\n    .then((response) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!callback) "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v("\n\n      callback({\n        isSuccess: "),t("span",{staticClass:"hljs-literal"},[s._v("true")]),s._v(",\n        data: response.data,\n        errorMessage: "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v("\n      })\n    })\n\n    .catch((error) => {\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (!callback) "),t("span",{staticClass:"hljs-keyword"},[s._v("return")]),s._v("\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("let")]),s._v(" errorMessage = "),t("span",{staticClass:"hljs-literal"},[s._v("null")]),s._v("\n\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (error.response) errorMessage = error.response.status\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" "),t("span",{staticClass:"hljs-keyword"},[s._v("if")]),s._v(" (error.request) errorMessage = "),t("span",{staticClass:"hljs-string"},[s._v("'no response from server'")]),s._v("\n      "),t("span",{staticClass:"hljs-keyword"},[s._v("else")]),s._v(" errorMessage = error.message\n\n      callback({\n        isSuccess: "),t("span",{staticClass:"hljs-literal"},[s._v("false")]),s._v(",\n        data: {},\n        errorMessage: errorMessage\n      })\n    })\n  }\n}")])])])])}],r={render:e,staticRenderFns:n};a.a=r},gUUB:function(s,a,t){"use strict";var e=t("c/Tr"),n=t.n(e);a.a={name:"authentication",mounted:function(){var s=this,a=n()(document.getElementsByClassName("title")),t=a.filter(function(a){return a.innerHTML===s.$route.query.title})[0];t?t.scrollIntoView():scroll(0,0)},data:function(){return{}},methods:{}}}});
//# sourceMappingURL=authentication.099f994883673692ee34.js.map